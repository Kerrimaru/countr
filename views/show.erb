<html>
<body>
<div id="counter"></div>
<div>
  <h2>Next steps</h2>
  <ul>
    <li>Put an element representing the counter into the div with id counter (name and count)</li>
    <li>Make a button in that element</li>
    <li>Make the button do something when it is clicked (e.g. alert)</li>
    <li>Make the button alert the current value + 1 when it is clicked</li>
    <li>Make the button alert the some json representing the new counter state (e.g. {"counter":{"count":4}} )</li>
    <li>Send an XHR PUT request with the json to the back end</li>
    <li>Update the element with the new values from the back end</li>
  </ul>
</body>
<script type="text/javascript">
var counter = <%= JSON.generate(@counter.as_json) %>
// Your code goes here

// function Counter(data){
//   this.data = data;
// }

function render (){
  var container = document.getElementById("counter");
  container.innerHTML = '';
  var butt_name = document.createElement("h2");
  butt_name.innerHTML = "Name: " + counter.name;
  container.appendChild(butt_name);

  var count = document.createElement("h3");
  count.id = "count_display";
  count.innerHTML = "Count: " + counter.count;
  container.appendChild(count);

  var button = document.createElement("button");
  button.innerHTML = 'Im a button';
  container.appendChild(button);

  button.addEventListener('click', function () {
    counter.count ++;
    countUp();

  });
}
render()

function countUp() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    console.log(counter)
    if (this.readyState == 4 && this.status == 200) {
      render()
    }
  };
  xhttp.open("PUT",  "/counters/" + counter.id, true);
  xhttp.send(JSON.stringify({"counter":{"count":counter.count}}));
}

</script>
</html>
