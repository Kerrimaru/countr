<html>
  <body>
    <div id="counter"></div>
    <div>
  </body>
<script type="text/javascript">

var counter = <%= JSON.generate(@counter.as_json) %>

CreateButton.prototype.render = function(){
  var self = this;  
  var container = this.el;
  container.innerHTML = '';  
  
  var butt_name = document.createElement("h2");
  butt_name.innerHTML = "Name: " + counter.name;
  container.appendChild(butt_name);

  var count = document.createElement("h3");
  count.id = "count_display";
  count.innerHTML = "Count: " + counter.count;
  container.appendChild(count);

  var button = document.createElement("button");
  button.innerHTML = "I'm a button";
  button.addEventListener('click', function(){    
    self.data.count ++;
    self.countUp();
  });
  container.appendChild(button);

  return container;
}

CreateButton.prototype.countUp = function(){
  self = this;
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      self.render();
    }
  } 
  xhttp.open("PUT", "/counters/" + counter.id, true);
  xhttp.send(JSON.stringify({"counter":{"count":counter.count}}));
}

function CreateButton(el, data){
  this.el = document.getElementById(el);
  this.data = data; 
  this.render();  
}

var newCounter = new CreateButton('counter', counter);

</script>
</html>
